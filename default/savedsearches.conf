[assetdb-lookupgen]
dispatch.earliest_time = -24h@h
dispatch.latest_time = now
display.general.timeRangePicker.show = 0
display.general.type = statistics
display.page.search.tab = statistics
display.visualizations.show = 0
request.ui_dispatch_app = assetdb
request.ui_dispatch_view = search
alert.track = 0
cron_schedule = 0 0 * * *
enableSched = 1
search = | makeresults\
| `append_adb_lookup(assetdb_demo_assets.csv)`\
| `append_adb_lookup(assetdb)`\
| foreach category, dns, ip, mac, nt_host, owner [eval <<FIELD>>=split(<<FIELD>>, "|")]\
| foreach _time, bunit, category, city, country, dns, ip, mac, nt_host, os, owner, priority [eval <<FIELD>>=lower(<<FIELD>>)]\
| eval _key = mvjoin(mvdedup(mvappend(mac, nt_host)), "::")\
| search _key=*\
| stats, latest(_time) as _time, latest(bunit) as bunit, values(category) as category, latest(city) as city, latest(country) as country, values(dns) as dns, values(ip) as ip, values(mac) as mac, values(nt_host) as nt_host, latest(os) as os, values(owner) as owner, max(priority) as priority by _key\
| eval _key = mvappend(mac, nt_host)\
| adbmerge max_keys=25\
| eval _key = md5(mvjoin(asset, "::"))\
| stats values(asset) as asset, latest(_time) as _time, latest(bunit) as bunit, values(category) as category, latest(city) as city, latest(country) as country, values(dns) as dns, values(ip) as ip, values(mac) as mac, values(nt_host) as nt_host, latest(os) as os, values(owner) as owner, max(priority) as priority by _key\
| eval category = mvindex(category,0,9), dns = mvindex(dns,0,9), ip = mvindex(ip,0,9), mac = mvindex(mac,0,9), nt_host = mvindex(nt_host,0,9), owner = mvindex(owner,0,9)\
| table _key, asset, _time, bunit, category, city, country, dns, ip, mac, nt_host, os, owner, priority\
| outputlookup assetdb
