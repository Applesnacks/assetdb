"use strict";

//# sourceURL=asset_base.js
require(['underscore', 'jquery', 'splunkjs/mvc', 'splunkjs/mvc/searchmanager', '/static/app/assetdb/js/modal.js', '/static/app/assetdb/js/textInput.js', '/static/app/assetdb/js/radioInput.js', '/static/app/assetdb/js/spinnerInput.js', '/static/app/assetdb/js/multiselectInput.js', 'splunkjs/mvc/simplexml/ready!'], function (_, $, mvc, SearchManager, Modal, TextInput, RadioInput, SpinnerInput, MultiSelectInput) {
  $el = $('#ab_config');
  var ENDPOINT_BASE = '/servicesNS/nobody/assetdb/configs/';
  var service = mvc.createService();

  function getConf(service, endpoint) {
    var path = ENDPOINT_BASE + endpoint;
    var deferred = service.get(path, {}, function (err, results) {});
    return deferred.promise();
  }

  function setConf(service, endpoint, data) {
    var path = ENDPOINT_BASE + endpoint;
    var deferred = service.post(path, data, function (err, results) {});
    return deferred.promise();
  }

  function delConf(service, endpoint) {
    var path = ENDPOINT_BASE + endpoint;
    var deferred = service.del(path, function (err, results) {
      deferred.resolve(results);
    });
    return deferred.promise();
  }

  function editAddField() {
    var field = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    var fieldNameInput = new TextInput({
      id: 'inputFieldName',
      label: 'Field Name',
      editable: field.name ? false : true,
      value: field.name || ''
    });
    var keyFieldInput = new RadioInput({
      id: 'inputKeyField',
      label: 'Key Field',
      choices: [{
        label: 'Yes',
        value: 1
      }, {
        label: 'No',
        value: 0
      }],
      value: field.key_field || 0,
      help: 'Key fields define a unique asset'
    });
    var caseSensitiveInput = new RadioInput({
      id: 'inputCaseSensitive',
      label: 'Case Sensitive',
      choices: [{
        label: 'Yes',
        value: 1
      }, {
        label: 'No',
        value: 0
      }],
      value: field.case_sensitive || 0,
      help: 'If No, field values are converted to lowercase'
    });
    var ignoreValuesInput = new TextInput({
      id: 'inputIgnoreValues',
      label: 'Ignore Values',
      value: field.ignore_values || 'null,unknown,undefined',
      help: '[Optional] A comma separated list of values to ignore'
    });
    var fillnullInput = new TextInput({
      id: 'inputFillnull',
      label: 'Fill Null',
      value: field.fillnull || '',
      help: '[Optional] Fill null entries with a static value'
    });
    var typeInput = new RadioInput({
      id: 'inputType',
      label: 'Type',
      choices: [{
        label: 'Single',
        value: 'single'
      }, {
        label: 'Multivalue',
        value: 'multivalue'
      }, {
        label: 'Eval',
        value: 'eval'
      }],
      value: field.type || 'single',
      help: 'Use a single value, keep all unique entries as a multivalue, or use an eval expression to define this field'
    });
    var mergeMethodInput = new RadioInput({
      id: 'inputMergeMethod',
      label: 'Merge Method',
      choices: [{
        label: 'Latest',
        value: 'latest'
      }, {
        label: 'Coalesce',
        value: 'coalesce'
      }],
      value: field.merge_method || 'latest',
      help: 'Either take the most recent value or define a precedence based on the source data'
    });
    var mergeOrderInput = new MultiSelectInput({
      id: 'inputMergeOrder',
      label: 'Merge Order',
      choices: [{
        label: 'test1',
        value: 'test1'
      }, {
        label: 'test2',
        value: 'test2'
      }, {
        label: 'test3',
        value: 'test3'
      }],
      value: field.merge_order || [],
      help: '[Optional] Define the precedence of the source data; if no precendence is provided, a random order is used'
    });
    var spinnerInput = new SpinnerInput({
      id: 'inputMaxValues',
      label: 'Max Values',
      value: field.max_values || 10,
      help: 'The maximum number of values to store as a multivalue'
    });
    var evalExpInput = new TextInput({
      id: 'inputEvalExp',
      label: 'Eval Expression',
      value: field.eval_expression || '',
      help: 'An SPL eval expression, example: replace(field1, "[^w]", "")'
    }); // Form

    $form = $("\n            <div class=\"form-horizontal\">\n                <div class=\"input-group-base\"></div>\n                <div class=\"input-group-toggle input-group-single\"></div>\n                <div class=\"input-group-toggle input-group-multivalue\"></div>\n                <div class=\"input-group-toggle input-group-eval\"></div>\n            </div>");
    $('.input-group-base', $form).append(fieldNameInput.getInput()).append(keyFieldInput.getInput()).append(caseSensitiveInput.getInput()).append(ignoreValuesInput.getInput()).append(fillnullInput.getInput()).append(typeInput.getInput());
    $('.input-group-single', $form).append(mergeMethodInput.getInput()).append(mergeOrderInput.getInput());
    $('.input-group-multivalue', $form).append(spinnerInput.getInput());
    $('.input-group-eval', $form).append(evalExpInput.getInput()); // Form section visibility

    var type = typeInput.getValue();
    $('.input-group-toggle', $form).hide();
    $(".input-group-".concat(type), $form).show();
    var mergeMethod = mergeMethodInput.getValue();
    var $input = mergeOrderInput.getInput();
    mergeMethod == 'latest' ? $input.hide() : $input.show();
    typeInput.getInput().on('change', function (e, data) {
      $('.input-group-toggle', $form).hide();
      $(".input-group-".concat(data.value), $form).show();
    });
    mergeMethodInput.getInput().on('change', function (e, data) {
      var $input = mergeOrderInput.getInput();
      data.value == 'latest' ? $input.hide() : $input.show();
    }); // Modal

    var editAddModal = new Modal({
      wide: true,
      title: field ? 'Edit Field' : 'Add Field',
      primaryButton: 'Save',
      onRemove: function onRemove() {
        console.log(mergeOrderInput.getId());
        mvc.Components.getInstance(mergeOrderInput.getId()).dispose();
      },
      onPrimaryBtnClick: function onPrimaryBtnClick() {
        var endpoint = 'conf-assetdb/';
        console.log(mergeOrderInput.getValue());
        var data = {
          key_field: keyFieldInput.getValue(),
          case_sensitive: caseSensitiveInput.getValue(),
          ignore_values: ignoreValuesInput.getValue(),
          fillnull: fillnullInput.getValue(),
          type: typeInput.getValue(),
          merge_method: mergeMethodInput.getValue(),
          merge_order: mergeOrderInput.getValue(),
          max_values: spinnerInput.getValue(),
          eval_expression: evalExpInput.getValue()
        };

        if (fieldNameInput.isEditable()) {
          data.name = fieldNameInput.getValue();
        } else {
          endpoint += fieldNameInput.getValue();
        }

        setConf(service, endpoint, data);
        this.hide();
      }
    }); // Set form body and show

    editAddModal.setBody($form);
    editAddModal.show();
  }

  $button = $('<button class="button">Click Me!</button>');
  $button.appendTo($el);
  $button.click(function () {
    editAddField();
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9hc3NldGRiLmpzIl0sIm5hbWVzIjpbInJlcXVpcmUiLCJfIiwiJCIsIm12YyIsIlNlYXJjaE1hbmFnZXIiLCJNb2RhbCIsIlRleHRJbnB1dCIsIlJhZGlvSW5wdXQiLCJTcGlubmVySW5wdXQiLCJNdWx0aVNlbGVjdElucHV0IiwiJGVsIiwiRU5EUE9JTlRfQkFTRSIsInNlcnZpY2UiLCJjcmVhdGVTZXJ2aWNlIiwiZ2V0Q29uZiIsImVuZHBvaW50IiwicGF0aCIsImRlZmVycmVkIiwiZ2V0IiwiZXJyIiwicmVzdWx0cyIsInByb21pc2UiLCJzZXRDb25mIiwiZGF0YSIsInBvc3QiLCJkZWxDb25mIiwiZGVsIiwicmVzb2x2ZSIsImVkaXRBZGRGaWVsZCIsImZpZWxkIiwiZmllbGROYW1lSW5wdXQiLCJpZCIsImxhYmVsIiwiZWRpdGFibGUiLCJuYW1lIiwidmFsdWUiLCJrZXlGaWVsZElucHV0IiwiY2hvaWNlcyIsImtleV9maWVsZCIsImhlbHAiLCJjYXNlU2Vuc2l0aXZlSW5wdXQiLCJjYXNlX3NlbnNpdGl2ZSIsImlnbm9yZVZhbHVlc0lucHV0IiwiaWdub3JlX3ZhbHVlcyIsImZpbGxudWxsSW5wdXQiLCJmaWxsbnVsbCIsInR5cGVJbnB1dCIsInR5cGUiLCJtZXJnZU1ldGhvZElucHV0IiwibWVyZ2VfbWV0aG9kIiwibWVyZ2VPcmRlcklucHV0IiwibWVyZ2Vfb3JkZXIiLCJzcGlubmVySW5wdXQiLCJtYXhfdmFsdWVzIiwiZXZhbEV4cElucHV0IiwiZXZhbF9leHByZXNzaW9uIiwiJGZvcm0iLCJhcHBlbmQiLCJnZXRJbnB1dCIsImdldFZhbHVlIiwiaGlkZSIsInNob3ciLCJtZXJnZU1ldGhvZCIsIiRpbnB1dCIsIm9uIiwiZSIsImVkaXRBZGRNb2RhbCIsIndpZGUiLCJ0aXRsZSIsInByaW1hcnlCdXR0b24iLCJvblJlbW92ZSIsImNvbnNvbGUiLCJsb2ciLCJnZXRJZCIsIkNvbXBvbmVudHMiLCJnZXRJbnN0YW5jZSIsImRpc3Bvc2UiLCJvblByaW1hcnlCdG5DbGljayIsImlzRWRpdGFibGUiLCJzZXRCb2R5IiwiJGJ1dHRvbiIsImFwcGVuZFRvIiwiY2xpY2siXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFFQUEsT0FBTyxDQUFDLENBQ1AsWUFETyxFQUVQLFFBRk8sRUFHUCxjQUhPLEVBSVAsNEJBSk8sRUFLUCxpQ0FMTyxFQU1QLHFDQU5PLEVBT1Asc0NBUE8sRUFRUCx3Q0FSTyxFQVNQLDRDQVRPLEVBVVAsK0JBVk8sQ0FBRCxFQVdKLFVBQVVDLENBQVYsRUFBYUMsQ0FBYixFQUFnQkMsR0FBaEIsRUFBcUJDLGFBQXJCLEVBQW9DQyxLQUFwQyxFQUEyQ0MsU0FBM0MsRUFBc0RDLFVBQXRELEVBQWtFQyxZQUFsRSxFQUFnRkMsZ0JBQWhGLEVBQWtHO0FBQ3BHQyxFQUFBQSxHQUFHLEdBQUdSLENBQUMsQ0FBQyxZQUFELENBQVA7QUFDQSxNQUFNUyxhQUFhLEdBQUcscUNBQXRCO0FBQ0EsTUFBSUMsT0FBTyxHQUFHVCxHQUFHLENBQUNVLGFBQUosRUFBZDs7QUFFQSxXQUFTQyxPQUFULENBQWlCRixPQUFqQixFQUEwQkcsUUFBMUIsRUFBb0M7QUFDbkMsUUFBSUMsSUFBSSxHQUFHTCxhQUFhLEdBQUdJLFFBQTNCO0FBQ0EsUUFBSUUsUUFBUSxHQUFHTCxPQUFPLENBQUNNLEdBQVIsQ0FBWUYsSUFBWixFQUFrQixFQUFsQixFQUFzQixVQUFVRyxHQUFWLEVBQWVDLE9BQWYsRUFBd0IsQ0FBRSxDQUFoRCxDQUFmO0FBQ0EsV0FBT0gsUUFBUSxDQUFDSSxPQUFULEVBQVA7QUFDQTs7QUFFRCxXQUFTQyxPQUFULENBQWlCVixPQUFqQixFQUEwQkcsUUFBMUIsRUFBb0NRLElBQXBDLEVBQTBDO0FBQ3pDLFFBQUlQLElBQUksR0FBR0wsYUFBYSxHQUFHSSxRQUEzQjtBQUNBLFFBQUlFLFFBQVEsR0FBR0wsT0FBTyxDQUFDWSxJQUFSLENBQWFSLElBQWIsRUFBbUJPLElBQW5CLEVBQXlCLFVBQVVKLEdBQVYsRUFBZUMsT0FBZixFQUF3QixDQUFF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ZCxFQUpBO0FBS1ZaLFVBQUFBLElBQUksRUFBRUQsU0FBUyxDQUFDYSxRQUFWLEVBTEk7QUFNVlYsVUFBQUEsWUFBWSxFQUFFRCxnQkFBZ0IsQ0FBQ1csUUFBakIsRUFOSjtBQU9WUixVQUFBQSxXQUFXLEVBQUVELGVBQWUsQ0FBQ1MsUUFBaEIsRUFQSDtBQVFWTixVQUFBQSxVQUFVLEVBQUVELFlBQVksQ0FBQ08sUUFBYixFQVJGO0FBU1ZKLFVBQUFBLGVBQWUsRUFBRUQsWUFBWSxDQUFDSyxRQUFiO0FBVFAsU0FBWDs7QUFZQSxZQUFJN0IsY0FBYyxDQUFDZ0QsVUFBZixFQUFKLEVBQWlDO0FBQ2hDdkQsVUFBQUEsSUFBSSxDQUFDVyxJQUFMLEdBQVlKLGNBQWMsQ0FBQzZCLFFBQWYsRUFBWjtBQUNBLFNBRkQsTUFFTztBQUNONUMsVUFBQUEsUUFBUSxJQUFJZSxjQUFjLENBQUM2QixRQUFmLEVBQVo7QUFDQTs7QUFFRHJDLFFBQUFBLE9BQU8sQ0FBQ1YsT0FBRCxFQUFVRyxRQUFWLEVBQW9CUSxJQUFwQixDQUFQO0FBQ0EsYUFBS3FDLElBQUw7QUFDQTtBQWhDMkIsS0FBVixDQUFuQixDQTFJaUMsQ0E2S2pDOztBQUNBTSxJQUFBQSxZQUFZLENBQUNhLE9BQWIsQ0FBcUJ2QixLQUFyQjtBQUNBVSxJQUFBQSxZQUFZLENBQUNMLElBQWI7QUFDQTs7QUFFRG1CLEVBQUFBLE9BQU8sR0FBRzlFLENBQUMsQ0FBQywyQ0FBRCxDQUFYO0FBQ0E4RSxFQUFBQSxPQUFPLENBQUNDLFFBQVIsQ0FBaUJ2RSxHQUFqQjtBQUVBc0UsRUFBQUEsT0FBTyxDQUFDRSxLQUFSLENBQWMsWUFBWTtBQUN6QnRELElBQUFBLFlBQVk7QUFDWixHQUZEO0FBR0EsQ0E1Tk0sQ0FBUCIsInNvdXJjZXNDb250ZW50IjpbIi8vIyBzb3VyY2VVUkw9YXNzZXRfYmFzZS5qc1xuXG5yZXF1aXJlKFtcblx0J3VuZGVyc2NvcmUnLFxuXHQnanF1ZXJ5Jyxcblx0J3NwbHVua2pzL212YycsXG5cdCdzcGx1bmtqcy9tdmMvc2VhcmNobWFuYWdlcicsXG5cdCcvc3RhdGljL2FwcC9hc3NldGRiL2pzL21vZGFsLmpzJyxcblx0Jy9zdGF0aWMvYXBwL2Fzc2V0ZGIvanMvdGV4dElucHV0LmpzJyxcblx0Jy9zdGF0aWMvYXBwL2Fzc2V0ZGIvanMvcmFkaW9JbnB1dC5qcycsXG5cdCcvc3RhdGljL2FwcC9hc3NldGRiL2pzL3NwaW5uZXJJbnB1dC5qcycsXG5cdCcvc3RhdGljL2FwcC9hc3NldGRiL2pzL211bHRpc2VsZWN0SW5wdXQuanMnLFxuXHQnc3BsdW5ranMvbXZjL3NpbXBsZXhtbC9yZWFkeSEnLFxuXSwgZnVuY3Rpb24gKF8sICQsIG12YywgU2VhcmNoTWFuYWdlciwgTW9kYWwsIFRleHRJbnB1dCwgUmFkaW9JbnB1dCwgU3Bpbm5lcklucHV0LCBNdWx0aVNlbGVjdElucHV0KSB7XG5cdCRlbCA9ICQoJyNhYl9jb25maWcnKTtcblx0Y29uc3QgRU5EUE9JTlRfQkFTRSA9ICcvc2VydmljZXNOUy9ub2JvZHkvYXNzZXRkYi9jb25maWdzLyc7XG5cdHZhciBzZXJ2aWNlID0gbXZjLmNyZWF0ZVNlcnZpY2UoKTtcblxuXHRmdW5jdGlvbiBnZXRDb25mKHNlcnZpY2UsIGVuZHBvaW50KSB7XG5cdFx0bGV0IHBhdGggPSBFTkRQT0lOVF9CQVNFICsgZW5kcG9pbnQ7XG5cdFx0bGV0IGRlZmVycmVkID0gc2VydmljZS5nZXQocGF0aCwge30sIGZ1bmN0aW9uIChlcnIsIHJlc3VsdHMpIHt9KTtcblx0XHRyZXR1cm4gZGVmZXJyZWQucHJvbWlzZSgpO1xuXHR9XG5cblx0ZnVuY3Rpb24gc2V0Q29uZihzZXJ2aWNlLCBlbmRwb2ludCwgZGF0YSkge1xuXHRcdGxldCBwYXRoID0gRU5EUE9JTlRfQkFTRSArIGVuZHBvaW50O1xuXHRcdGxldCBkZWZlcnJlZCA9IHNlcnZpY2UucG9zdChwYXRoLCBkYXRhLCBmdW5jdGlvbiAoZXJyLCByZXN1bHRzKSB7fSk7XG5cdFx0cmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTtcblx0fVxuXG5cdGZ1bmN0aW9uIGRlbENvbmYoc2VydmljZSwgZW5kcG9pbnQpIHtcblx0XHRsZXQgcGF0aCA9IEVORFBPSU5UX0JBU0UgKyBlbmRwb2ludDtcblx0XHRsZXQgZGVmZXJyZWQgPSBzZXJ2aWNlLmRlbChwYXRoLCBmdW5jdGlvbiAoZXJyLCByZXN1bHRzKSB7XG5cdFx0XHRkZWZlcnJlZC5yZXNvbHZlKHJlc3VsdHMpO1xuXHRcdH0pO1xuXHRcdHJldHVybiBkZWZlcnJlZC5wcm9taXNlKCk7XG5cdH1cblxuXHRmdW5jdGlvbiBlZGl0QWRkRmllbGQoZmllbGQgPSB7fSkge1xuXHRcdGxldCBmaWVsZE5hbWVJbnB1dCA9IG5ldyBUZXh0SW5wdXQoe1xuXHRcdFx0aWQ6ICdpbnB1dEZpZWxkTmFtZScsXG5cdFx0XHRsYWJlbDogJ0ZpZWxkIE5hbWUnLFxuXHRcdFx0ZWRpdGFibGU6IGZpZWxkLm5hbWUgPyBmYWxzZSA6IHRydWUsXG5cdFx0XHR2YWx1ZTogZmllbGQubmFtZSB8fCAnJyxcblx0XHR9KTtcblxuXHRcdGxldCBrZXlGaWVsZElucHV0ID0gbmV3IFJhZGlvSW5wdXQoe1xuXHRcdFx0aWQ6ICdpbnB1dEtleUZpZWxkJyxcblx0XHRcdGxhYmVsOiAnS2V5IEZpZWxkJyxcblx0XHRcdGNob2ljZXM6IFtcblx0XHRcdFx0eyBsYWJlbDogJ1llcycsIHZhbHVlOiAxIH0sXG5cdFx0XHRcdHsgbGFiZWw6ICdObycsIHZhbHVlOiAwIH0sXG5cdFx0XHRdLFxuXHRcdFx0dmFsdWU6IGZpZWxkLmtleV9maWVsZCB8fCAwLFxuXHRcdFx0aGVscDogJ0tleSBmaWVsZHMgZGVmaW5lIGEgdW5pcXVlIGFzc2V0Jyxcblx0XHR9KTtcblxuXHRcdGxldCBjYXNlU2Vuc2l0aXZlSW5wdXQgPSBuZXcgUmFkaW9JbnB1dCh7XG5cdFx0XHRpZDogJ2lucHV0Q2FzZVNlbnNpdGl2ZScsXG5cdFx0XHRsYWJlbDogJ0Nhc2UgU2Vuc2l0aXZlJyxcblx0XHRcdGNob2ljZXM6IFtcblx0XHRcdFx0eyBsYWJlbDogJ1llcycsIHZhbHVlOiAxIH0sXG5cdFx0XHRcdHsgbGFiZWw6ICdObycsIHZhbHVlOiAwIH0sXG5cdFx0XHRdLFxuXHRcdFx0dmFsdWU6IGZpZWxkLmNhc2Vfc2Vuc2l0aXZlIHx8IDAsXG5cdFx0XHRoZWxwOiAnSWYgTm8sIGZpZWxkIHZhbHVlcyBhcmUgY29udmVydGVkIHRvIGxvd2VyY2FzZScsXG5cdFx0fSk7XG5cblx0XHRsZXQgaWdub3JlVmFsdWVzSW5wdXQgPSBuZXcgVGV4dElucHV0KHtcblx0XHRcdGlkOiAnaW5wdXRJZ25vcmVWYWx1ZXMnLFxuXHRcdFx0bGFiZWw6ICdJZ25vcmUgVmFsdWVzJyxcblx0XHRcdHZhbHVlOiBmaWVsZC5pZ25vcmVfdmFsdWVzIHx8ICdudWxsLHVua25vd24sdW5kZWZpbmVkJyxcblx0XHRcdGhlbHA6ICdbT3B0aW9uYWxdIEEgY29tbWEgc2VwYXJhdGVkIGxpc3Qgb2YgdmFsdWVzIHRvIGlnbm9yZScsXG5cdFx0fSk7XG5cblx0XHRsZXQgZmlsbG51bGxJbnB1dCA9IG5ldyBUZXh0SW5wdXQoe1xuXHRcdFx0aWQ6ICdpbnB1dEZpbGxudWxsJyxcblx0XHRcdGxhYmVsOiAnRmlsbCBOdWxsJyxcblx0XHRcdHZhbHVlOiBmaWVsZC5maWxsbnVsbCB8fCAnJyxcblx0XHRcdGhlbHA6ICdbT3B0aW9uYWxdIEZpbGwgbnVsbCBlbnRyaWVzIHdpdGggYSBzdGF0aWMgdmFsdWUnLFxuXHRcdH0pO1xuXG5cdFx0bGV0IHR5cGVJbnB1dCA9IG5ldyBSYWRpb0lucHV0KHtcblx0XHRcdGlkOiAnaW5wdXRUeXBlJyxcblx0XHRcdGxhYmVsOiAnVHlwZScsXG5cdFx0XHRjaG9pY2VzOiBbXG5cdFx0XHRcdHsgbGFiZWw6ICdTaW5nbGUnLCB2YWx1ZTogJ3NpbmdsZScgfSxcblx0XHRcdFx0eyBsYWJlbDogJ011bHRpdmFsdWUnLCB2YWx1ZTogJ211bHRpdmFsdWUnIH0sXG5cdFx0XHRcdHsgbGFiZWw6ICdFdmFsJywgdmFsdWU6ICdldmFsJyB9LFxuXHRcdFx0XSxcblx0XHRcdHZhbHVlOiBmaWVsZC50eXBlIHx8ICdzaW5nbGUnLFxuXHRcdFx0aGVscDpcblx0XHRcdFx0J1VzZSBhIHNpbmdsZSB2YWx1ZSwga2VlcCBhbGwgdW5pcXVlIGVudHJpZXMgYXMgYSBtdWx0aXZhbHVlLCBvciB1c2UgYW4gZXZhbCBleHByZXNzaW9uIHRvIGRlZmluZSB0aGlzIGZpZWxkJyxcblx0XHR9KTtcblxuXHRcdGxldCBtZXJnZU1ldGhvZElucHV0ID0gbmV3IFJhZGlvSW5wdXQoe1xuXHRcdFx0aWQ6ICdpbnB1dE1lcmdlTWV0aG9kJyxcblx0XHRcdGxhYmVsOiAnTWVyZ2UgTWV0aG9kJyxcblx0XHRcdGNob2ljZXM6IFtcblx0XHRcdFx0eyBsYWJlbDogJ0xhdGVzdCcsIHZhbHVlOiAnbGF0ZXN0JyB9LFxuXHRcdFx0XHR7IGxhYmVsOiAnQ29hbGVzY2UnLCB2YWx1ZTogJ2NvYWxlc2NlJyB9LFxuXHRcdFx0XSxcblx0XHRcdHZhbHVlOiBmaWVsZC5tZXJnZV9tZXRob2QgfHwgJ2xhdGVzdCcsXG5cdFx0XHRoZWxwOiAnRWl0aGVyIHRha2UgdGhlIG1vc3QgcmVjZW50IHZhbHVlIG9yIGRlZmluZSBhIHByZWNlZGVuY2UgYmFzZWQgb24gdGhlIHNvdXJjZSBkYXRhJyxcblx0XHR9KTtcblxuXHRcdGxldCBtZXJnZU9yZGVySW5wdXQgPSBuZXcgTXVsdGlTZWxlY3RJbnB1dCh7XG5cdFx0XHRpZDogJ2lucHV0TWVyZ2VPcmRlcicsXG5cdFx0XHRsYWJlbDogJ01lcmdlIE9yZGVyJyxcblx0XHRcdGNob2ljZXM6IFtcblx0XHRcdFx0eyBsYWJlbDogJ3Rlc3QxJywgdmFsdWU6ICd0ZXN0MScgfSxcblx0XHRcdFx0eyBsYWJlbDogJ3Rlc3QyJywgdmFsdWU6ICd0ZXN0MicgfSxcblx0XHRcdFx0eyBsYWJlbDogJ3Rlc3QzJywgdmFsdWU6ICd0ZXN0MycgfSxcblx0XHRcdF0sXG5cdFx0XHR2YWx1ZTogZmllbGQubWVyZ2Vfb3JkZXIgfHwgW10sXG5cdFx0XHRoZWxwOlxuXHRcdFx0XHQnW09wdGlvbmFsXSBEZWZpbmUgdGhlIHByZWNlZGVuY2Ugb2YgdGhlIHNvdXJjZSBkYXRhOyBpZiBubyBwcmVjZW5kZW5jZSBpcyBwcm92aWRlZCwgYSByYW5kb20gb3JkZXIgaXMgdXNlZCcsXG5cdFx0fSk7XG5cblx0XHRsZXQgc3Bpbm5lcklucHV0ID0gbmV3IFNwaW5uZXJJbnB1dCh7XG5cdFx0XHRpZDogJ2lucHV0TWF4VmFsdWVzJyxcblx0XHRcdGxhYmVsOiAnTWF4IFZhbHVlcycsXG5cdFx0XHR2YWx1ZTogZmllbGQubWF4X3ZhbHVlcyB8fCAxMCxcblx0XHRcdGhlbHA6ICdUaGUgbWF4aW11bSBudW1iZXIgb2YgdmFsdWVzIHRvIHN0b3JlIGFzIGEgbXVsdGl2YWx1ZScsXG5cdFx0fSk7XG5cblx0XHRsZXQgZXZhbEV4cElucHV0ID0gbmV3IFRleHRJbnB1dCh7XG5cdFx0XHRpZDogJ2lucHV0RXZhbEV4cCcsXG5cdFx0XHRsYWJlbDogJ0V2YWwgRXhwcmVzc2lvbicsXG5cdFx0XHR2YWx1ZTogZmllbGQuZXZhbF9leHByZXNzaW9uIHx8ICcnLFxuXHRcdFx0aGVscDogJ0FuIFNQTCBldmFsIGV4cHJlc3Npb24sIGV4YW1wbGU6IHJlcGxhY2UoZmllbGQxLCBcIlted11cIiwgXCJcIiknLFxuXHRcdH0pO1xuXG5cdFx0Ly8gRm9ybVxuXHRcdCRmb3JtID0gJChgXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZm9ybS1ob3Jpem9udGFsXCI+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImlucHV0LWdyb3VwLWJhc2VcIj48L2Rpdj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiaW5wdXQtZ3JvdXAtdG9nZ2xlIGlucHV0LWdyb3VwLXNpbmdsZVwiPjwvZGl2PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJpbnB1dC1ncm91cC10b2dnbGUgaW5wdXQtZ3JvdXAtbXVsdGl2YWx1ZVwiPjwvZGl2PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJpbnB1dC1ncm91cC10b2dnbGUgaW5wdXQtZ3JvdXAtZXZhbFwiPjwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+YCk7XG5cblx0XHQkKCcuaW5wdXQtZ3JvdXAtYmFzZScsICRmb3JtKVxuXHRcdFx0LmFwcGVuZChmaWVsZE5hbWVJbnB1dC5nZXRJbnB1dCgpKVxuXHRcdFx0LmFwcGVuZChrZXlGaWVsZElucHV0LmdldElucHV0KCkpXG5cdFx0XHQuYXBwZW5kKGNhc2VTZW5zaXRpdmVJbnB1dC5nZXRJbnB1dCgpKVxuXHRcdFx0LmFwcGVuZChpZ25vcmVWYWx1ZXNJbnB1dC5nZXRJbnB1dCgpKVxuXHRcdFx0LmFwcGVuZChmaWxsbnVsbElucHV0LmdldElucHV0KCkpXG5cdFx0XHQuYXBwZW5kKHR5cGVJbnB1dC5nZXRJbnB1dCgpKTtcblxuXHRcdCQoJy5pbnB1dC1ncm91cC1zaW5nbGUnLCAkZm9ybSkuYXBwZW5kKG1lcmdlTWV0aG9kSW5wdXQuZ2V0SW5wdXQoKSkuYXBwZW5kKG1lcmdlT3JkZXJJbnB1dC5nZXRJbnB1dCgpKTtcblxuXHRcdCQoJy5pbnB1dC1ncm91cC1tdWx0aXZhbHVlJywgJGZvcm0pLmFwcGVuZChzcGlubmVySW5wdXQuZ2V0SW5wdXQoKSk7XG5cblx0XHQkKCcuaW5wdXQtZ3JvdXAtZXZhbCcsICRmb3JtKS5hcHBlbmQoZXZhbEV4cElucHV0LmdldElucHV0KCkpO1xuXG5cdFx0Ly8gRm9ybSBzZWN0aW9uIHZpc2liaWxpdHlcblx0XHRsZXQgdHlwZSA9IHR5cGVJbnB1dC5nZXRWYWx1ZSgpO1xuXHRcdCQoJy5pbnB1dC1ncm91cC10b2dnbGUnLCAkZm9ybSkuaGlkZSgpO1xuXHRcdCQoYC5pbnB1dC1ncm91cC0ke3R5cGV9YCwgJGZvcm0pLnNob3coKTtcblxuXHRcdGxldCBtZXJnZU1ldGhvZCA9IG1lcmdlTWV0aG9kSW5wdXQuZ2V0VmFsdWUoKTtcblx0XHRsZXQgJGlucHV0ID0gbWVyZ2VPcmRlcklucHV0LmdldElucHV0KCk7XG5cdFx0bWVyZ2VNZXRob2QgPT0gJ2xhdGVzdCcgPyAkaW5wdXQuaGlkZSgpIDogJGlucHV0LnNob3coKTtcblxuXHRcdHR5cGVJbnB1dC5nZXRJbnB1dCgpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoZSwgZGF0YSkge1xuXHRcdFx0JCgnLmlucHV0LWdyb3VwLXRvZ2dsZScsICRmb3JtKS5oaWRlKCk7XG5cdFx0XHQkKGAuaW5wdXQtZ3JvdXAtJHtkYXRhLnZhbHVlfWAsICRmb3JtKS5zaG93KCk7XG5cdFx0fSk7XG5cblx0XHRtZXJnZU1ldGhvZElucHV0LmdldElucHV0KCkub24oJ2NoYW5nZScsIGZ1bmN0aW9uIChlLCBkYXRhKSB7XG5cdFx0XHRsZXQgJGlucHV0ID0gbWVyZ2VPcmRlcklucHV0LmdldElucHV0KCk7XG5cdFx0XHRkYXRhLnZhbHVlID09ICdsYXRlc3QnID8gJGlucHV0LmhpZGUoKSA6ICRpbnB1dC5zaG93KCk7XG5cdFx0fSk7XG5cblx0XHQvLyBNb2RhbFxuXHRcdGxldCBlZGl0QWRkTW9kYWwgPSBuZXcgTW9kYWwoe1xuXHRcdFx0d2lkZTogdHJ1ZSxcblx0XHRcdHRpdGxlOiBmaWVsZCA/ICdFZGl0IEZpZWxkJyA6ICdBZGQgRmllbGQnLFxuXHRcdFx0cHJpbWFyeUJ1dHRvbjogJ1NhdmUnLFxuXHRcdFx0b25SZW1vdmU6IGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0Y29uc29sZS5sb2cobWVyZ2VPcmRlcklucHV0LmdldElkKCkpO1xuXHRcdFx0XHRtdmMuQ29tcG9uZW50cy5nZXRJbnN0YW5jZShtZXJnZU9yZGVySW5wdXQuZ2V0SWQoKSkuZGlzcG9zZSgpO1xuXHRcdFx0fSxcblx0XHRcdG9uUHJpbWFyeUJ0bkNsaWNrOiBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdGxldCBlbmRwb2ludCA9ICdjb25mLWFzc2V0ZGIvJztcblx0XHRcdFx0Y29uc29sZS5sb2cobWVyZ2VPcmRlcklucHV0LmdldFZhbHVlKCkpO1xuXG5cdFx0XHRcdGxldCBkYXRhID0ge1xuXHRcdFx0XHRcdGtleV9maWVsZDoga2V5RmllbGRJbnB1dC5nZXRWYWx1ZSgpLFxuXHRcdFx0XHRcdGNhc2Vfc2Vuc2l0aXZlOiBjYXNlU2Vuc2l0aXZlSW5wdXQuZ2V0VmFsdWUoKSxcblx0XHRcdFx0XHRpZ25vcmVfdmFsdWVzOiBpZ25vcmVWYWx1ZXNJbnB1dC5nZXRWYWx1ZSgpLFxuXHRcdFx0XHRcdGZpbGxudWxsOiBmaWxsbnVsbElucHV0LmdldFZhbHVlKCksXG5cdFx0XHRcdFx0dHlwZTogdHlwZUlucHV0LmdldFZhbHVlKCksXG5cdFx0XHRcdFx0bWVyZ2VfbWV0aG9kOiBtZXJnZU1ldGhvZElucHV0LmdldFZhbHVlKCksXG5cdFx0XHRcdFx0bWVyZ2Vfb3JkZXI6IG1lcmdlT3JkZXJJbnB1dC5nZXRWYWx1ZSgpLFxuXHRcdFx0XHRcdG1heF92YWx1ZXM6IHNwaW5uZXJJbnB1dC5nZXRWYWx1ZSgpLFxuXHRcdFx0XHRcdGV2YWxfZXhwcmVzc2lvbjogZXZhbEV4cElucHV0LmdldFZhbHVlKCksXG5cdFx0XHRcdH07XG5cblx0XHRcdFx0aWYgKGZpZWxkTmFtZUlucHV0LmlzRWRpdGFibGUoKSkge1xuXHRcdFx0XHRcdGRhdGEubmFtZSA9IGZpZWxkTmFtZUlucHV0LmdldFZhbHVlKCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0ZW5kcG9pbnQgKz0gZmllbGROYW1lSW5wdXQuZ2V0VmFsdWUoKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHNldENvbmYoc2VydmljZSwgZW5kcG9pbnQsIGRhdGEpO1xuXHRcdFx0XHR0aGlzLmhpZGUoKTtcblx0XHRcdH0sXG5cdFx0fSk7XG5cblx0XHQvLyBTZXQgZm9ybSBib2R5IGFuZCBzaG93XG5cdFx0ZWRpdEFkZE1vZGFsLnNldEJvZHkoJGZvcm0pO1xuXHRcdGVkaXRBZGRNb2RhbC5zaG93KCk7XG5cdH1cblxuXHQkYnV0dG9uID0gJCgnPGJ1dHRvbiBjbGFzcz1cImJ1dHRvblwiPkNsaWNrIE1lITwvYnV0dG9uPicpO1xuXHQkYnV0dG9uLmFwcGVuZFRvKCRlbCk7XG5cblx0JGJ1dHRvbi5jbGljayhmdW5jdGlvbiAoKSB7XG5cdFx0ZWRpdEFkZEZpZWxkKCk7XG5cdH0pO1xufSk7XG4iXX0=